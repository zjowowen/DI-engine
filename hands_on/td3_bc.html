

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TD3BC &mdash; DI-engine 0.1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="QMIX" href="qmix.html" />
    <link rel="prev" title="CQL" href="cql.html" />
    <link href="../_static/css/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> DI-engine
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick_start/index.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../key_concept/index.html">Key Concept</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro_rl/index.html">Introduction to RL</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">RL Algorithm Cheat Sheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../env_tutorial/index.html">RL Environments Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distributed/index.html">Distributed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../best_practice/index.html">Best Practice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_doc/index.html">API Doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../feature/index.html">Feature</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../guide/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial_dev/index.html">Tutorial-Developer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture/index.html">Architecture Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../specification/index.html">Middleware code specification</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DI-engine</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">RL Algorithm Cheat Sheet</a> &raquo;</li>
        
      <li>TD3BC</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/hands_on/td3_bc.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="td3bc">
<h1>TD3BC<a class="headerlink" href="#td3bc" title="Permalink to this headline">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>TD3BC, proposed in the 2021 paper <a class="reference external" href="https://arxiv.org/abs/2106.06860">A Minimalist Approach to Offline Reinforcement Learning</a>,
is a simple approach to offline RL where <strong>only two changes</strong> are made to TD3: a weighted behavior cloning loss is added to the policy update and the states are normalized.
Unlike competing methods there are no changes to architecture or underlying hyperparameters.
The resulting algorithm is a simple baseline that is easy to implement and tune, while more than halving the overall run time by removing the additional computational overhead of previous methods.</p>
<figure class="align-center" id="id1">
<img alt="../_images/td3bc_paper_table1.png" src="../_images/td3bc_paper_table1.png" />
<figcaption>
<p><span class="caption-text">Implementation changes offline RL algorithms make to the underlying base RL algorithm. † corresponds
to details that add additional hyperparameter(s), and ‡ corresponds to ones that add a computational cost.
<a class="reference external" href="https://arxiv.org/abs/2106.06860">Ref</a></span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="quick-facts">
<h2>Quick Facts<a class="headerlink" href="#quick-facts" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>TD3BC is an <strong>offline</strong> RL algorithm.</p></li>
<li><p>TD3BC is based on <strong>TD3</strong> and <strong>behavior cloning</strong>.</p></li>
</ol>
</section>
<section id="key-equations-or-key-graphs">
<h2>Key Equations or Key Graphs<a class="headerlink" href="#key-equations-or-key-graphs" title="Permalink to this headline">¶</a></h2>
<p>TD3BC simply consists to add a behavior cloning term to TD3 in order to regularize the policy:</p>
<div class="math notranslate nohighlight">
\[\begin{aligned}
\pi = \arg\max_{\pi} \mathbb{E}_{(s, a) \sim D} [ \lambda Q(s, \pi(s)) - (\pi(s)-a)^2 ]
\end{aligned}\]</div>
<p><span class="math notranslate nohighlight">\((\pi(s)-a)^2\)</span> is the behavior cloning term acts as a regularizer and aims to push the policy towards favoring
actions contained in the dataset. The hyperparameter <span class="math notranslate nohighlight">\(\lambda\)</span> is used to control the strength of the
regularizer.</p>
<p>Assuming an action range of [−1, 1], the BC term is at most 4, however the range of Q will be a function of the scale of
the reward. Consequently, the scalar <span class="math notranslate nohighlight">\(\lambda\)</span> can be defined as:</p>
<div class="math notranslate nohighlight">
\[\begin{aligned}
\lambda = \frac{\alpha}{\frac{1}{N}\sum_{s_i, a_i}|Q(s_i, a_i)|}
\end{aligned}\]</div>
<p>which is simply a normalization term based on the average absolute value of Q over mini-batches. This formulation has
also the benefit of normalizing the learning rate across tasks since it is dependent on the scale of Q. The default
value for <span class="math notranslate nohighlight">\(\alpha\)</span> is 2.5.</p>
<p>Additionally, all the states in each mini-batch are normalized, such that they have mean 0 and standard deviation 1.
This normalization improves the stability of the learned policy.</p>
</section>
<section id="implementations">
<h2>Implementations<a class="headerlink" href="#implementations" title="Permalink to this headline">¶</a></h2>
<p>The default config is defined as follows:</p>
<section id="model">
<h3>Model<a class="headerlink" href="#model" title="Permalink to this headline">¶</a></h3>
<p>Here we provide examples of <cite>td3_bc</cite> model as default model for <cite>TD3BC</cite>.</p>
</section>
</section>
<section id="benchmark">
<h2>Benchmark<a class="headerlink" href="#benchmark" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 12%" />
<col style="width: 38%" />
<col style="width: 19%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>environment</p></th>
<th class="head"><p>best mean reward</p></th>
<th class="head"><p>evaluation results</p></th>
<th class="head"><p>config link</p></th>
<th class="head"><p>comparison</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Halfcheetah</p>
<p>(Medium Expert)</p>
</td>
<td><p>13037</p></td>
<td><img alt="../_images/halfcheetah_td3bc.png" src="../_images/halfcheetah_td3bc.png" />
</td>
<td><p><a class="reference external" href="https://github.com/opendilab/DI-engine/blob/main/dizoo/d4rl/config/halfcheetah_td3bc_medium_expert_config.py">config_link_ha</a></p></td>
<td><p>d3rlpy(12124)</p></td>
</tr>
<tr class="row-odd"><td><p>Walker2d</p>
<p>(Medium Expert)</p>
</td>
<td><p>5066</p></td>
<td><img alt="../_images/walker2d_td3bc.png" src="../_images/walker2d_td3bc.png" />
</td>
<td><p><a class="reference external" href="https://github.com/opendilab/DI-engine/blob/main/dizoo/d4rl/config/walker2d_td3bc_medium_expert_config.py">config_link_w</a></p></td>
<td><p>d3rlpy(5108)</p></td>
</tr>
<tr class="row-even"><td><p>Hopper</p>
<p>(Medium Expert)</p>
</td>
<td><p>3653</p></td>
<td><img alt="../_images/hopper_td3bc.png" src="../_images/hopper_td3bc.png" />
</td>
<td><p><a class="reference external" href="https://github.com/opendilab/DI-engine/blob/main/dizoo/d4rl/config/hopper_sac_td3bc_medium_expert_config.py">config_link_ho</a></p></td>
<td><p>d3rlpy(3690)</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 19%" />
<col style="width: 18%" />
<col style="width: 17%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>environment</p></th>
<th class="head"><p>random</p></th>
<th class="head"><p>medium replay</p></th>
<th class="head"><p>medium expert</p></th>
<th class="head"><p>medium</p></th>
<th class="head"><p>expert</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Halfcheetah</p></td>
<td><p>1592</p></td>
<td><p>5192</p></td>
<td><p>13037</p></td>
<td><p>5257</p></td>
<td><p>13247</p></td>
</tr>
<tr class="row-odd"><td><p>Walker2d</p></td>
<td><p>345</p></td>
<td><p>1724</p></td>
<td><p>3653</p></td>
<td><p>3268</p></td>
<td><p>3664</p></td>
</tr>
<tr class="row-even"><td><p>Hopper</p></td>
<td><p>985</p></td>
<td><p>2317</p></td>
<td><p>5066</p></td>
<td><p>3826</p></td>
<td><p>5232</p></td>
</tr>
</tbody>
</table>
<p><strong>Note</strong>: the D4RL environment used in this benchmark can be found <a class="reference external" href="https://github.com/rail-berkeley/d4rl">here</a>.</p>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Scott Fujimoto, Shixiang Shane Gu: “A Minimalist Approach to Offline Reinforcement Learning”, 2021; [<a class="reference external" href="https://arxiv.org/abs/2106.06860">https://arxiv.org/abs/2106.06860</a> arXiv:2106.06860].</p></li>
<li><p>Scott Fujimoto, Herke van Hoof, David Meger: “Addressing Function Approximation Error in Actor-Critic Methods”, 2018; [<a class="reference external" href="http://arxiv.org/abs/1802.09477">http://arxiv.org/abs/1802.09477</a> arXiv:1802.09477].</p></li>
</ul>
</section>
<section id="other-public-implementations">
<h2>Other Public Implementations<a class="headerlink" href="#other-public-implementations" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/sfujim/TD3_BC">Official implementation</a></p></li>
<li><p><a class="reference external" href="https://github.com/takuseno/d3rlpy">d3rlpy</a></p></li>
</ul>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="qmix.html" class="btn btn-neutral float-right" title="QMIX" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="cql.html" class="btn btn-neutral float-left" title="CQL" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, OpenDILab Contributors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>