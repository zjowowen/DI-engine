

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Env Overview &mdash; DI-engine 0.1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Collector Overview" href="collector_overview.html" />
    <link rel="prev" title="Model Overview" href="model_overview.html" />
    <link href="../_static/css/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> DI-engine
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick_start/index.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../key_concept/index.html">Key Concept</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro_rl/index.html">Introduction to RL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hands_on/index.html">RL Algorithm Cheat Sheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../env_tutorial/index.html">RL Environments Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distributed/index.html">Distributed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../best_practice/index.html">Best Practice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_doc/index.html">API Doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Feature</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="algorithm_overview.html">Algorithm Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="policy_overview.html">Policy Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="model_overview.html">Model Overview</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Env Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#baseenv">BaseEnv</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="collector_overview.html">Collector Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="env_manager_overview.html">Env Manager Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="replay_buffer_overview.html">Replay Buffer Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="learner_overview.html">Learner Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="wrapper_hook_overview.html">Wrapper &amp; Hook Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="league_overview.html">League Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="hpc_rl_overview.html">DI-hpc Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="orchestrator_overview.html">DI-orchestrator Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="interaction_overview.html">Interaction Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="loader_overview.html">Loader Overview</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../guide/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial_dev/index.html">Tutorial-Developer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture/index.html">Architecture Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../specification/index.html">Middleware code specification</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DI-engine</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Feature</a> &raquo;</li>
        
      <li>Env Overview</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/feature/env_overview.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="env-overview">
<h1>Env Overview<a class="headerlink" href="#env-overview" title="Permalink to this headline">¶</a></h1>
<section id="baseenv">
<h2>BaseEnv<a class="headerlink" href="#baseenv" title="Permalink to this headline">¶</a></h2>
<p>(ding/envs/env/base_env.py)</p>
<dl>
<dt>Overview:</dt><dd><p>The Environment module is one of the important modules in reinforcement learning (RL). In some common RL tasks, such as <a class="reference external" href="https://gym.openai.com/envs/#atari">atari</a> tasks and <a class="reference external" href="https://gym.openai.com/envs/#mujoco">mujoco</a> tasks, the agent we train is to explore and learn in such an environment. Generally, to define an environment, you need to start with the input and output of the environment, and fully consider the possible observation space and action space. The <cite>gym</cite> module produced by OpenAI has helped us define most of the commonly used academic environments. <cite>DI-engine</cite> also follows the definition of <cite>gym.Env</cite>, and adds a series of more convenient functions to it, making the call of the environment easier to understand.</p>
</dd>
<dt>Implementation:</dt><dd><p>The key concepts of the defination of <a class="reference external" href="https://github.com/openai/gym/blob/master/gym/core.py#L8">gym.Env</a> are methods including <code class="docutils literal notranslate"><span class="pre">step()</span></code> and <code class="docutils literal notranslate"><span class="pre">reset()</span></code>. According to the given <code class="docutils literal notranslate"><span class="pre">observation</span></code>, <code class="docutils literal notranslate"><span class="pre">step()</span></code> interacts with the environment based on the input <code class="docutils literal notranslate"><span class="pre">action</span></code>, and return related <code class="docutils literal notranslate"><span class="pre">reward</span></code>. The environment is reset when we call <code class="docutils literal notranslate"><span class="pre">reset()</span></code>. Regarding the observation, action, and reward in the environment, their definitions and restrictions are also given, which are <code class="docutils literal notranslate"><span class="pre">observation_space</span></code> <code class="docutils literal notranslate"><span class="pre">action_space</span></code> and <code class="docutils literal notranslate"><span class="pre">reward_range</span></code>.</p>
<p><cite>ding.envs.BaseEnv</cite> is similar to <cite>gym.Env</cite>, in addition to the above interfaces and features, <cite>ding.envs.BaseEnv</cite> also defines and implements:</p>
<p>1. <code class="docutils literal notranslate"><span class="pre">BaseEnvTimestep(namedtuple)</span></code>:
It defines what environment returns when <code class="docutils literal notranslate"><span class="pre">step()</span></code> is called, usually including <code class="docutils literal notranslate"><span class="pre">obs</span></code>, <code class="docutils literal notranslate"><span class="pre">act</span></code>,  <code class="docutils literal notranslate"><span class="pre">reward</span></code>,  <code class="docutils literal notranslate"><span class="pre">done</span></code> and <code class="docutils literal notranslate"><span class="pre">info</span></code>. You can inherit from <code class="docutils literal notranslate"><span class="pre">BaseEnvTimestep</span></code> and define your owned variables.</p>
<ol class="arabic simple" start="2">
<li><p>space property: Di-engine retains the definitions of <code class="docutils literal notranslate"><span class="pre">observation_space</span></code> and <code class="docutils literal notranslate"><span class="pre">action_space</span></code>, and expands <code class="docutils literal notranslate"><span class="pre">reward_range</span></code> to <code class="docutils literal notranslate"><span class="pre">reward_space</span></code>, making it consistent with the previous two. In the case of a multi-agent environment, <code class="docutils literal notranslate"><span class="pre">num_agent</span></code> should also be specified.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">shared_memory</span></code> in <code class="docutils literal notranslate"><span class="pre">subprocess_env_manager</span></code> depends on <code class="docutils literal notranslate"><span class="pre">obs_space</span></code>. If you want to use <code class="docutils literal notranslate"><span class="pre">shared_memory</span></code>, you must make sure use <code class="docutils literal notranslate"><span class="pre">observation_space</span></code> is correctly specified.</p>
</div>
<p>3. <code class="docutils literal notranslate"><span class="pre">create_collector_env_cfg()</span></code>:
It is used to create config for collectors. It is independent of <code class="docutils literal notranslate"><span class="pre">create_evaluator_env_cfg</span></code>, which is convenient for users to set different environmental parameters for data collection and performance evaluation. According to the incoming initial configuration, a corresponding configuration file is generated for each specific environment. By default, The number of environments in the configuration file will be obtained, and then copy the corresponding number of copies of the default environment configuration to return.</p>
<p>4. <code class="docutils literal notranslate"><span class="pre">create_evaluator_env_cfg():</span></code>
It is to create a corresponding environment configuration file for performance evaluation. The function is the same as the above description.</p>
<p>5. <code class="docutils literal notranslate"><span class="pre">enable_save_replay()</span></code>:
The environment can save the running process as a video file, which is convenient for debugging and visualization. It is generally called before the actual running of the environment, and it is often used for notifying the env should save replay and the save path. (This method is optional to implement).</p>
<p>Besides, some changes have also been made to the details in <cite>ding.envs.BaseEnv</cite>, such as:</p>
<ol class="arabic simple">
<li><p>seed(): For the seed control of various processing functions and wrappers in the environment, the external setting is the seed of the seed. When the environment is used to collect data, it is also common to distinguish between <strong>static torrents and dynamic torrents</strong></p></li>
<li><p><strong>Lazy init</strong> is used by default, which means, init only sets the parameters, and the environment is initialized and set seed at the first reset.</p></li>
<li><p>At the end of the episode, return the <code class="docutils literal notranslate"><span class="pre">final_eval_reward</span></code> key-value pair in the <code class="docutils literal notranslate"><span class="pre">BaseEnvTimestep.info</span></code> dict</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<blockquote>
<div><p>For the specific creation of an environment (such as opening other simulator clients), this behavior should not be implemented in the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method, because there are scenarios that create model instances but do not run (such as obtaining information such as the dimensions of the environment observation). It is recommended to implement in the <code class="docutils literal notranslate"><span class="pre">reset</span></code> method, which means to determine whether the operating environment has been created, if not, create and then reset, or directly reset the existing environment. If the user still wants to complete this function in the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method, please confirm by yourself that there will be no waste of resources or conflicts.</p>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Regarding <code class="docutils literal notranslate"><span class="pre">BaseEnvTimestep</span></code>, if there is no special requirement, you can directly call the default definition provided by DI-engine, namely:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ding.envs</span> <span class="kn">import</span> <span class="n">BaseEnvTimestep</span>
</pre></div>
</div>
<p>If you need to customize it, you can use <code class="docutils literal notranslate"><span class="pre">namedtuple(BaseEnvTimestep)</span></code>.</p>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<blockquote>
<div><p>The <code class="docutils literal notranslate"><span class="pre">seed()</span></code> method is usually called after the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method and before the <code class="docutils literal notranslate"><span class="pre">reset()</span></code> method. If the creation of the model is placed in the <code class="docutils literal notranslate"><span class="pre">reset()</span></code> method, the <code class="docutils literal notranslate"><span class="pre">seed()</span></code> method only needs to record this value and set the random seed when the <code class="docutils literal notranslate"><span class="pre">reset()</span></code> method is executed.</p>
</div></blockquote>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>DI-engine has some dependencies on the <code class="docutils literal notranslate"><span class="pre">BaseEnvTimestep.info</span></code> field returned by the environment. <code class="docutils literal notranslate"><span class="pre">BaseEnvTimestep.info</span></code> returns a dict, and some key-value pairs have related dependencies:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">final_eval_reward</span></code>: The key value must be included at the end of an episode of the environment (done=True), and the value is of type float, which means that the environment runs an episode performance measurement</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">abnormal</span></code>: Each time step of the environment can contain the key value, the key value is not required, it is an optional key value, and the value is of type bool, indicating whether an error occurred during the operation of the environment, and if it is true, the relevant modules of the will process the step (for example, the relevant data will be removed).</p></li>
</ol>
</div>
</div>
<p>The class inheritance relationship is shown in the following figure:</p>
<blockquote>
<div><a class="reference internal image-reference" href="../_images/baseenv_class_uml.png"><img alt="../_images/baseenv_class_uml.png" class="align-center" src="../_images/baseenv_class_uml.png" style="width: 165.6px; height: 262.8px;" /></a>
</div></blockquote>
</dd>
</dl>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="collector_overview.html" class="btn btn-neutral float-right" title="Collector Overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="model_overview.html" class="btn btn-neutral float-left" title="Model Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, OpenDILab Contributors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>